<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor: Davi Moreira">

<title> MGMT 17300: Data Mining Lab  – MGMT 17300: Data Mining Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/mgmt_17300_ai_logo_03.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/davi-moreira/2025S_data_mining_lab_purdue_MGMT173" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule and Material</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a>
  <ul class="collapse">
  <li><a href="#what-is-clustering" id="toc-what-is-clustering" class="nav-link" data-scroll-target="#what-is-clustering">What is Clustering?</a></li>
  </ul></li>
  <li><a href="#clustering-methods" id="toc-clustering-methods" class="nav-link" data-scroll-target="#clustering-methods">Clustering Methods</a>
  <ul class="collapse">
  <li><a href="#main-clustering-methods" id="toc-main-clustering-methods" class="nav-link" data-scroll-target="#main-clustering-methods">Main Clustering Methods</a></li>
  </ul></li>
  <li><a href="#generating-a-business-focused-synthetic-dataset" id="toc-generating-a-business-focused-synthetic-dataset" class="nav-link" data-scroll-target="#generating-a-business-focused-synthetic-dataset">Generating a Business-Focused Synthetic Dataset</a>
  <ul class="collapse">
  <li><a href="#generating-a-business-focused-synthetic-dataset-1" id="toc-generating-a-business-focused-synthetic-dataset-1" class="nav-link" data-scroll-target="#generating-a-business-focused-synthetic-dataset-1">Generating a Business-Focused Synthetic Dataset</a></li>
  </ul></li>
  <li><a href="#preparing-data-for-clustering" id="toc-preparing-data-for-clustering" class="nav-link" data-scroll-target="#preparing-data-for-clustering">Preparing Data for Clustering</a>
  <ul class="collapse">
  <li><a href="#scaling-data-for-clustering" id="toc-scaling-data-for-clustering" class="nav-link" data-scroll-target="#scaling-data-for-clustering">Scaling Data for Clustering</a></li>
  </ul></li>
  <li><a href="#number-of-clusters" id="toc-number-of-clusters" class="nav-link" data-scroll-target="#number-of-clusters">Number of Clusters</a>
  <ul class="collapse">
  <li><a href="#methods-to-determine-the-number-of-clusters" id="toc-methods-to-determine-the-number-of-clusters" class="nav-link" data-scroll-target="#methods-to-determine-the-number-of-clusters">Methods to Determine the Number of Clusters</a></li>
  <li><a href="#number-of-clusters-elbow-method" id="toc-number-of-clusters-elbow-method" class="nav-link" data-scroll-target="#number-of-clusters-elbow-method">Number of Clusters: Elbow Method</a></li>
  </ul></li>
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-means Clustering</a>
  <ul class="collapse">
  <li><a href="#k-means-clustering-1" id="toc-k-means-clustering-1" class="nav-link" data-scroll-target="#k-means-clustering-1">K-means Clustering</a></li>
  <li><a href="#k-means-clustering-2" id="toc-k-means-clustering-2" class="nav-link" data-scroll-target="#k-means-clustering-2">K-means Clustering</a></li>
  <li><a href="#visualizing-k-means-clusters" id="toc-visualizing-k-means-clusters" class="nav-link" data-scroll-target="#visualizing-k-means-clusters">Visualizing K-means Clusters</a></li>
  <li><a href="#interpreting-clusters-for-business" id="toc-interpreting-clusters-for-business" class="nav-link" data-scroll-target="#interpreting-clusters-for-business">Interpreting Clusters for Business</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank you!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="08_unsupervised_learning_cluster.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></h1>
<p class="subtitle lead"><span style="font-size: 150%;">Unsupervised Learning: Clustering</span></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Professor: Davi Moreira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<!---
::: {style="font-size: 80%;"}

::: {.columns}
::: {.column width="50%"}

<br>

<br>

XXXX r code XXXX

:::

::: {.column width="50%"}

:::: nonincremental

XXXX bullets XXXX

::::
:::
:::
:::

--->
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<div class="nonincremental">
<div class="columns">
<div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li>Clustering</li>
<li>Clustering Methods</li>
<li>Preparing Data for Clustering</li>
</ul>
</div><div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li>Number of Clusters</li>
<li>K-means Clustering</li>
</ul>
</div>
</div>
</div>
</section>
<section id="clustering" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Clustering</h1>
<section id="what-is-clustering" class="level2">
<h2 class="anchored" data-anchor-id="what-is-clustering">What is Clustering?</h2>
<ul>
<li><p><strong>Clustering</strong> is an <strong>unsupervised learning</strong> technique for finding patterns or groupings in data, without relying on predefined labels.</p></li>
<li><p><strong>Common Business Applications</strong>:</p>
<ul>
<li><strong>Customer Segmentation</strong>: Identify groups of customers with similar buying behaviors or demographics.</li>
<li><strong>Market Segmentation</strong>: Find potential submarkets for targeted marketing campaigns.</li>
<li><strong>Anomaly Detection</strong>: Detect unusual transactions or outliers in finance.</li>
</ul></li>
<li><p><strong>Key Idea</strong>: We measure similarity (or distance) among data points and group the “closest” points together.</p></li>
</ul>
</section>
</section>
<section id="clustering-methods" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Clustering Methods</h1>
<section id="main-clustering-methods" class="level2">
<h2 class="anchored" data-anchor-id="main-clustering-methods">Main Clustering Methods</h2>
<div style="font-size: 80%;">
<p><strong>Choosing a Method</strong>: The best clustering technique depends on the nature of the data, the goals of analysis, and computational constraints.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>Characteristics</strong></th>
<th><strong>Strengths</strong></th>
<th><strong>Weaknesses</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>K-means</strong></td>
<td>Divides data into non-overlapping groups based on minimizing within-cluster variance.</td>
<td>Simple and efficient for large datasets.</td>
<td>Sensitive to outliers and requires predefining the number of clusters (k).</td>
</tr>
<tr class="even">
<td><strong>Hierarchical</strong></td>
<td>Builds a tree-like structure (dendrogram) to group data hierarchically.</td>
<td>Does not require predefining the number of clusters; visualizes relationships.</td>
<td>Computationally expensive for large datasets; less scalable.</td>
</tr>
<tr class="odd">
<td><a href="https://www.naftaliharris.com/blog/visualizing-dbscan-clustering/"><strong>DBSCAN</strong></a></td>
<td>Groups data based on density of points in a region.</td>
<td>Can find arbitrarily shaped clusters and detect outliers.</td>
<td>Struggles with varying densities and high-dimensional data.</td>
</tr>
<tr class="even">
<td><strong>Spectral</strong></td>
<td>Uses graph theory to partition data based on eigenvalues of similarity matrices.</td>
<td>Effective for complex cluster structures and non-linear separations.</td>
<td>Computationally intensive; requires tuning parameters like similarity metric.</td>
</tr>
<tr class="odd">
<td><strong>Gaussian Mixture</strong></td>
<td>Fits data to a probabilistic model, assuming data is generated from Gaussian distributions.</td>
<td>Handles overlapping clusters and provides probabilities of cluster membership.</td>
<td>Sensitive to initialization and assumes Gaussian distribution.</td>
</tr>
</tbody>
</table>
</div>
<!---
## Detailed Explanations:

1. **K-means**:
   - Works by assigning data points to the nearest centroid.
   - Predefine the number of clusters (`k`) and iteratively update cluster centroids until they stabilize.
   - **When to use**: Datasets with distinct clusters and similar density.

2. **Hierarchical Clustering**:
   - Produces a dendrogram that illustrates how data points are grouped.
   - No need to predefine the number of clusters; you can decide the cut point from the dendrogram.
   - **When to use**: Small datasets where relationships between clusters are crucial.

3. **DBSCAN (Density-Based Spatial Clustering of Applications with Noise)**:
   - Identifies clusters as regions of high density separated by low-density regions.
   - Effective for clusters of arbitrary shapes and detecting noise or outliers.
   - **When to use**: Spatial data or datasets with noise and variable densities.

4. **Spectral Clustering**:
   - Constructs a similarity graph and uses eigenvalues to partition the graph.
   - Effective for non-linear or complex-shaped clusters.
   - **When to use**: Datasets with intricate cluster boundaries that traditional methods struggle with.

5. **Gaussian Mixture Models (GMMs)**:
   - Models data as a mixture of multiple Gaussian distributions.
   - Provides probabilities for data points belonging to clusters.
   - **When to use**: Overlapping clusters or probabilistic modeling of cluster membership.

- **Choosing a Method**: The best clustering technique depends on the data's structure, size, and the business question you aim to address.

--->
</section>
</section>
<section id="generating-a-business-focused-synthetic-dataset" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Generating a Business-Focused Synthetic Dataset</h1>
<section id="generating-a-business-focused-synthetic-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="generating-a-business-focused-synthetic-dataset-1">Generating a Business-Focused Synthetic Dataset</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>This dataset simulates the type of information businesses collect to better understand and segment their customer base. Clustering these data points can reveal groups with similar characteristics, enabling targeted strategies:</p>
<ul>
<li><strong>Demographics</strong>: Age of the customer.</li>
<li><strong>Financials</strong>: Annual income and credit score.</li>
<li><strong>Behavioral Metrics</strong>: Online purchases, store visits, and a calculated spending score.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of "customers"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">198</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic customer data with clear clustering patterns</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>CustomerID       <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>Age              <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">3</span>)),  <span class="co"># Younger group</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">40</span>, <span class="at">sd =</span> <span class="dv">3</span>)),  <span class="co"># Middle-aged group</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">55</span>, <span class="at">sd =</span> <span class="dv">3</span>))   <span class="co"># Older group</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>Annual_Income    <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">30000</span>, <span class="at">sd =</span> <span class="dv">2000</span>)),  <span class="co"># Lower-income group</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">75000</span>, <span class="at">sd =</span> <span class="dv">5000</span>)),  <span class="co"># Middle-income group</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">120000</span>, <span class="at">sd =</span> <span class="dv">10000</span>)) <span class="co"># Higher-income group</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>Credit_Score     <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">300</span>, <span class="at">max =</span> <span class="dv">550</span>)),  <span class="co"># Poor credit score group</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">600</span>, <span class="at">max =</span> <span class="dv">750</span>)),  <span class="co"># Fair credit score group</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">800</span>, <span class="at">max =</span> <span class="dv">850</span>))   <span class="co"># Excellent credit score group</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>Online_Purchases <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">15</span>, <span class="at">max =</span> <span class="dv">20</span>)),      <span class="co"># High engagement group</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">15</span>)),     <span class="co"># Medium engagement group</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>))     <span class="co"># Low engagement group</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>Store_Visits     <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">3</span>)),      <span class="co"># Low frequency group</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">4</span>, <span class="at">max =</span> <span class="dv">7</span>)),      <span class="co"># Medium frequency group</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">min =</span> <span class="dv">8</span>, <span class="at">max =</span> <span class="dv">10</span>))      <span class="co"># High frequency group</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>Spending_Score   <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">5</span>)),     <span class="co"># Low spending group</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">5</span>)),     <span class="co"># Medium spending group</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">rnorm</span>(n <span class="sc">/</span> <span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">70</span>, <span class="at">sd =</span> <span class="dv">5</span>))      <span class="co"># High spending group</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine variables into a data frame</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>business_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  CustomerID,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  Age,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  Annual_Income,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  Credit_Score,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  Online_Purchases,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  Store_Visits,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  Spending_Score</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick exploration of the generated data</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co"># head(business_data)   # Preview the first few rows</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(business_data) # Summary statistics for a deeper understanding</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preparing-data-for-clustering" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Preparing Data for Clustering</h1>
<section id="scaling-data-for-clustering" class="level2">
<h2 class="anchored" data-anchor-id="scaling-data-for-clustering">Scaling Data for Clustering</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<ul>
<li><p><strong>Why Scaling Matters</strong>: Clustering methods like K-means rely on distance calculations (e.g., Euclidean distance) to group data points. Variables with larger scales (like income) can disproportionately influence the results, overshadowing variables with smaller ranges (like the number of store visits).</p></li>
<li><p><strong>Scaling Process</strong>: Standardizing the data ensures that all variables contribute equally to the distance calculations. After scaling, each variable will have: Mean = 0 and Standard Deviation = 1.</p></li>
<li><p><strong>Key Outcome</strong>: Scaling ensures that no single variable dominates due to its range, enabling fair and accurate clustering. By scaling, we prepare the dataset for clustering while preserving the relationships and patterns inherent in the original data.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select relevant columns for clustering (excluding the CustomerID)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>business_features <span class="ot">&lt;-</span> business_data[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale data so that each feature contributes more equally</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>business_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(business_features)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check scaled data</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># head(business_scaled)  # Preview the scaled data to verify changes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="number-of-clusters" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Number of Clusters</h1>
<section id="methods-to-determine-the-number-of-clusters" class="level2">
<h2 class="anchored" data-anchor-id="methods-to-determine-the-number-of-clusters">Methods to Determine the Number of Clusters</h2>
<div style="font-size: 60%;">
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 40%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>How it Works</strong></th>
<th><strong>When to Use</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Elbow Method</strong></td>
<td>Plots the within-cluster sum of squares (WSS) against the number of clusters (k). The “elbow” point suggests the optimal k.</td>
<td>Suitable for datasets with compact, well-separated clusters. Provides a visual heuristic but can be subjective.</td>
</tr>
<tr class="even">
<td><strong>Silhouette Method</strong></td>
<td>Measures how similar an object is to its own cluster compared to other clusters. The average silhouette score indicates clustering quality.</td>
<td>Ideal when seeking well-defined clusters with clear separation. Helps assess cluster validity without relying on visual interpretation.</td>
</tr>
<tr class="odd">
<td><strong>Gap Statistic</strong></td>
<td>Compares total within-cluster variation for different k values against random data. The k with the largest gap indicates the optimal number of clusters.</td>
<td>Effective for complex datasets with no obvious structure. Computationally intensive but provides robust results.</td>
</tr>
<tr class="even">
<td><strong>Hierarchical Clustering (Dendrograms)</strong></td>
<td>Uses a dendrogram to visualize data merging at different levels. Cut the dendrogram at the height corresponding to the desired number of clusters.</td>
<td>Useful for smaller datasets or when visualizing relationships between clusters is important. Less effective for large datasets due to computational overhead.</td>
</tr>
<tr class="odd">
<td><strong>Bayesian Information Criterion (BIC)</strong></td>
<td>Evaluates models based on statistical criteria, balancing model fit and complexity. Lower BIC scores suggest better models with appropriate cluster numbers.</td>
<td>Effective for probabilistic clustering methods like Gaussian Mixture Models. Requires knowledge of model assumptions.</td>
</tr>
</tbody>
</table>
</div>
<p>Here’s the updated slide with an added explanation about how the Elbow Method works:</p>
</section>
<section id="number-of-clusters-elbow-method" class="level2">
<h2 class="anchored" data-anchor-id="number-of-clusters-elbow-method">Number of Clusters: Elbow Method</h2>
<div class="nonincremental">
<div style="font-size: 70%;">
<p><strong>How the Elbow Method Works</strong>:</p>
<ul>
<li>The Elbow Method involves plotting the within-cluster sum of squares (WSS) against the number of clusters (k).</li>
<li>WSS measures the total variance within clusters, and as the number of clusters increases, WSS decreases.</li>
<li>The “elbow point” is where the rate of decrease in WSS slows down significantly. This point suggests the optimal number of clusters (k) as it balances cluster compactness and simplicity.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_unsupervised_learning_cluster_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation</strong>: we might choose <strong>k = 3</strong> based on the Elbow Method, as the WSS shows a noticeable change in slope at this point.</p>
</div>
</div>
</section>
</section>
<section id="k-means-clustering" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">K-means Clustering</h1>
<section id="k-means-clustering-1" class="level2">
<h2 class="anchored" data-anchor-id="k-means-clustering-1">K-means Clustering</h2>
<p><br></p>
<p><br></p>
<center>
<p><strong>Simulation!</strong></p>
<p><a href="https://www.naftaliharris.com/blog/visualizing-k-means-clustering/" class="uri">https://www.naftaliharris.com/blog/visualizing-k-means-clustering/</a></p>
</center>
</section>
<section id="k-means-clustering-2" class="level2">
<h2 class="anchored" data-anchor-id="k-means-clustering-2">K-means Clustering</h2>
<div style="font-size: 80%;">
<ol type="1">
<li><p>The K-means algorithm begins by randomly assigning initial centroids within the data space.</p>
<ul>
<li><code>nstart = 25</code> means 25 different random initial centroid sets are tested, helping achieve a more stable solution.</li>
</ul></li>
<li><p>Each data point is then assigned to the nearest centroid, forming preliminary clusters.</p></li>
<li><p>The centroids are updated by recalculating the mean position of all points within each cluster.</p></li>
<li><p>These steps—assignment and centroid update—repeat iteratively until convergence, where cluster memberships no longer change and the centroids stabilize.</p>
<ul>
<li><code>km_res$cluster</code> returns the cluster assignment for each observation.</li>
</ul></li>
</ol>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's pick k=3 based on the elbow plot</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>km_res <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(business_scaled, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the results</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># km_res</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># head(km_res$cluster)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-k-means-clusters" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-k-means-clusters">Visualizing K-means Clusters</h2>
<div style="font-size: 80%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_unsupervised_learning_cluster_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The plot maps high-dimensional data into 2D using PCA (Principal Component Analysis) to make it easier to interpret.</li>
<li>Each cluster formed in the original high-dimensional space is projected into 2D and represented by a unique color and surrounded by an ellipse showing the confidence region.</li>
<li>Centroids (cluster centers) are marked to summarize each group.</li>
</ul>
</div>
</section>
<section id="interpreting-clusters-for-business" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-clusters-for-business">Interpreting Clusters for Business</h2>
<div style="font-size: 80%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster info to the original data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>business_data<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> km_res<span class="sc">$</span>cluster</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average values per cluster</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>cluster_eda <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(. <span class="sc">~</span> Cluster, <span class="at">data =</span> business_data[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">FUN =</span> mean)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster_eda</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Insights:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Cluster 1</th>
<th>Cluster 2</th>
<th>Cluster 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Age</strong></td>
<td>Older (~54.86)</td>
<td>Middle-aged (~40.05)</td>
<td>Youngest (~25.08)</td>
</tr>
<tr class="even">
<td><strong>Annual Income</strong></td>
<td>Highest (~$119,371)</td>
<td>Moderate (~$76,047.36)</td>
<td>Lowest (~$29,954.50)</td>
</tr>
<tr class="odd">
<td><strong>Credit Score</strong></td>
<td>Excellent (~824.67)</td>
<td>Moderate (~676.21)</td>
<td>Lowest (~418.36)</td>
</tr>
<tr class="even">
<td><strong>Online Purchases</strong></td>
<td>Lowest (~2.45)</td>
<td>Moderate (~9.94)</td>
<td>Highest (~17.38)</td>
</tr>
<tr class="odd">
<td><strong>Store Visits</strong></td>
<td>Highest (~8.88 visits)</td>
<td>Moderate (~5.51 visits)</td>
<td>Lowest (~1.97 visits)</td>
</tr>
<tr class="even">
<td><strong>Spending Score</strong></td>
<td>High (~70.56)</td>
<td>Moderate (~49.97)</td>
<td>Low (~30.76)</td>
</tr>
</tbody>
</table>
<p><strong>Business Potential Implications</strong>:</p>
<ul>
<li><strong>Cluster 1</strong>: Target high-income customers with store-centric promotions.</li>
<li><strong>Cluster 2</strong>: Leverage moderate online and in-store engagement for balanced campaigns.</li>
<li><strong>Cluster 3</strong>: Focus on e-commerce strategies to engage younger, lower-income customers.</li>
</ul>
</div>
</section>
</section>
<section id="summary" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Summary</h1>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">Summary</h2>
<div class="nonincremental">
<div style="font-size: 99%;">
<p>Main Takeaways from this lecture:</p>
<div class="nonincremental">
<div style="font-size: 95%;">
<ul>
<li><p><strong>Clustering</strong> is an <strong>unsupervised learning</strong> method that groups data based on similarity, without pre-existing labels.</p></li>
<li><p><strong>K-means</strong> is a widely used technique that requires:</p>
<ul>
<li><strong>Choosing the number of clusters (k)</strong>, often guided by the <strong>Elbow Method</strong> or other metrics.</li>
<li><strong>Scaling</strong> data so no variable dominates due to differing scales.</li>
</ul></li>
<li><p>A <strong>business-focused synthetic dataset</strong> (Age, Income, Credit Score, etc.) demonstrates how clustering reveals <strong>customer segments</strong> with distinct demographic, financial, and behavioral traits.</p></li>
<li><p><strong>Cluster interpretation</strong> involves examining average features per cluster and translating these differences into actionable insights (e.g., targeted marketing, store vs.&nbsp;online promotions).</p></li>
<li><p>Other clustering methods (<strong>Hierarchical, DBSCAN, Spectral, Gaussian Mixtures</strong>) may offer advantages for different data structures or domain needs.</p></li>
</ul>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="thank-you" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Thank you!</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>