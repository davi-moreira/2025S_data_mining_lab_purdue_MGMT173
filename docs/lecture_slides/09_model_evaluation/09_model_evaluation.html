<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor: Davi Moreira">

<title> MGMT 17300: Data Mining Lab  – MGMT 17300: Data Mining Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/mgmt_17300_ai_logo_03.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/davi-moreira/2025S_data_mining_lab_purdue_MGMT173" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule and Material</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a>
  <ul class="collapse">
  <li><a href="#what-is-a-classification-problem" id="toc-what-is-a-classification-problem" class="nav-link" data-scroll-target="#what-is-a-classification-problem">What is a classification problem?</a></li>
  </ul></li>
  <li><a href="#introduction-to-logistic-regression" id="toc-introduction-to-logistic-regression" class="nav-link" data-scroll-target="#introduction-to-logistic-regression">Introduction to Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#what-is-logistic-regression" id="toc-what-is-logistic-regression" class="nav-link" data-scroll-target="#what-is-logistic-regression">What is Logistic Regression?</a></li>
  <li><a href="#why-logistic-regression" id="toc-why-logistic-regression" class="nav-link" data-scroll-target="#why-logistic-regression">Why Logistic Regression?</a></li>
  </ul></li>
  <li><a href="#logistic-regression-framework" id="toc-logistic-regression-framework" class="nav-link" data-scroll-target="#logistic-regression-framework">Logistic Regression Framework</a>
  <ul class="collapse">
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  <li><a href="#the-logistic-regression-model" id="toc-the-logistic-regression-model" class="nav-link" data-scroll-target="#the-logistic-regression-model">The Logistic Regression Model</a>
  <ul class="collapse">
  <li><a href="#log-odds-equation" id="toc-log-odds-equation" class="nav-link" data-scroll-target="#log-odds-equation">Log-Odds Equation</a></li>
  <li><a href="#converting-log-odds-to-probability" id="toc-converting-log-odds-to-probability" class="nav-link" data-scroll-target="#converting-log-odds-to-probability">Converting Log-Odds to Probability</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#generating-a-synthetic-business-dataset" id="toc-generating-a-synthetic-business-dataset" class="nav-link" data-scroll-target="#generating-a-synthetic-business-dataset">Generating a Synthetic Business Dataset</a>
  <ul class="collapse">
  <li><a href="#generating-a-synthetic-business-dataset-1" id="toc-generating-a-synthetic-business-dataset-1" class="nav-link" data-scroll-target="#generating-a-synthetic-business-dataset-1">Generating a Synthetic Business Dataset</a></li>
  <li><a href="#generating-a-synthetic-business-dataset-2" id="toc-generating-a-synthetic-business-dataset-2" class="nav-link" data-scroll-target="#generating-a-synthetic-business-dataset-2">Generating a Synthetic Business Dataset</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a>
  <ul class="collapse">
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary Statistics</a></li>
  <li><a href="#age-vs.-purchase-probability" id="toc-age-vs.-purchase-probability" class="nav-link" data-scroll-target="#age-vs.-purchase-probability">Age vs.&nbsp;Purchase Probability</a></li>
  <li><a href="#income-vs.-purchase-probability" id="toc-income-vs.-purchase-probability" class="nav-link" data-scroll-target="#income-vs.-purchase-probability">Income vs.&nbsp;Purchase Probability</a></li>
  <li><a href="#purchase-rate-by-gender" id="toc-purchase-rate-by-gender" class="nav-link" data-scroll-target="#purchase-rate-by-gender">Purchase Rate by Gender</a></li>
  <li><a href="#purchase-probability-by-engagement" id="toc-purchase-probability-by-engagement" class="nav-link" data-scroll-target="#purchase-probability-by-engagement">Purchase Probability by Engagement</a></li>
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">Correlation Matrix</a></li>
  </ul></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train-Test Split</a>
  <ul class="collapse">
  <li><a href="#train-test-split-1" id="toc-train-test-split-1" class="nav-link" data-scroll-target="#train-test-split-1">Train-Test Split</a></li>
  <li><a href="#baseline-prediction" id="toc-baseline-prediction" class="nav-link" data-scroll-target="#baseline-prediction">Baseline Prediction</a></li>
  </ul></li>
  <li><a href="#model-training-fitting-a-logistic-regression-model" id="toc-model-training-fitting-a-logistic-regression-model" class="nav-link" data-scroll-target="#model-training-fitting-a-logistic-regression-model">Model Training<br>Fitting a Logistic Regression Model</a>
  <ul class="collapse">
  <li><a href="#fitting-a-logistic-regression-model" id="toc-fitting-a-logistic-regression-model" class="nav-link" data-scroll-target="#fitting-a-logistic-regression-model">Fitting a Logistic Regression Model</a></li>
  </ul></li>
  <li><a href="#predictions-on-the-test-set" id="toc-predictions-on-the-test-set" class="nav-link" data-scroll-target="#predictions-on-the-test-set">Predictions on the Test Set</a>
  <ul class="collapse">
  <li><a href="#predictions-on-the-test-set-1" id="toc-predictions-on-the-test-set-1" class="nav-link" data-scroll-target="#predictions-on-the-test-set-1">Predictions on the Test Set</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion Matrix</a></li>
  <li><a href="#confusion-matrix-1" id="toc-confusion-matrix-1" class="nav-link" data-scroll-target="#confusion-matrix-1">Confusion Matrix</a></li>
  <li><a href="#accuracy" id="toc-accuracy" class="nav-link" data-scroll-target="#accuracy">Accuracy</a></li>
  <li><a href="#recall-sensitivity" id="toc-recall-sensitivity" class="nav-link" data-scroll-target="#recall-sensitivity">Recall (Sensitivity)</a></li>
  <li><a href="#specificity" id="toc-specificity" class="nav-link" data-scroll-target="#specificity">Specificity</a></li>
  <li><a href="#precision" id="toc-precision" class="nav-link" data-scroll-target="#precision">Precision</a></li>
  <li><a href="#f1-score" id="toc-f1-score" class="nav-link" data-scroll-target="#f1-score">F1-Score</a></li>
  </ul></li>
  <li><a href="#roc-curve-auc" id="toc-roc-curve-auc" class="nav-link" data-scroll-target="#roc-curve-auc">ROC Curve &amp; AUC</a>
  <ul class="collapse">
  <li><a href="#roc-curve-auc-1" id="toc-roc-curve-auc-1" class="nav-link" data-scroll-target="#roc-curve-auc-1">ROC Curve &amp; AUC</a></li>
  <li><a href="#roc-curve-auc-2" id="toc-roc-curve-auc-2" class="nav-link" data-scroll-target="#roc-curve-auc-2">ROC Curve &amp; AUC</a></li>
  </ul></li>
  <li><a href="#k-fold-cross-validation" id="toc-k-fold-cross-validation" class="nav-link" data-scroll-target="#k-fold-cross-validation">K-Fold Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#k-fold-cross-validation-1" id="toc-k-fold-cross-validation-1" class="nav-link" data-scroll-target="#k-fold-cross-validation-1">K-Fold Cross-Validation</a></li>
  <li><a href="#k-fold-cross-validation-2" id="toc-k-fold-cross-validation-2" class="nav-link" data-scroll-target="#k-fold-cross-validation-2">K-Fold Cross-Validation</a></li>
  </ul></li>
  <li><a href="#comparing-train-test-performance-and-k-fold-cross-validation-performance" id="toc-comparing-train-test-performance-and-k-fold-cross-validation-performance" class="nav-link" data-scroll-target="#comparing-train-test-performance-and-k-fold-cross-validation-performance">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</a>
  <ul class="collapse">
  <li><a href="#comparing-train-test-performance-and-k-fold-cross-validation-performance-1" id="toc-comparing-train-test-performance-and-k-fold-cross-validation-performance-1" class="nav-link" data-scroll-target="#comparing-train-test-performance-and-k-fold-cross-validation-performance-1">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</a></li>
  <li><a href="#comparing-train-test-performance-and-k-fold-cross-validation-performance-2" id="toc-comparing-train-test-performance-and-k-fold-cross-validation-performance-2" class="nav-link" data-scroll-target="#comparing-train-test-performance-and-k-fold-cross-validation-performance-2">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</a></li>
  <li><a href="#visualizing-single-train-test-vs-k-fold-cv" id="toc-visualizing-single-train-test-vs-k-fold-cv" class="nav-link" data-scroll-target="#visualizing-single-train-test-vs-k-fold-cv">Visualizing Single Train-Test vs K-Fold CV</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank you!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="09_model_evaluation.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></h1>
<p class="subtitle lead"><span style="font-size: 150%;">Model Evaluation with Logistic Regression</span></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Professor: Davi Moreira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<div class="nonincremental">
<div class="columns">
<div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li>Introduction to Logistic Regression</li>
<li>Train-Test Split</li>
<li>Model Training: Fitting a Logistic Regression Model<br>
</li>
<li>Predictions on the Test Set</li>
</ul>
</div><div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li><p>Model Evaluation</p>
<ul>
<li>Confusion Matrix</li>
<li>Sensitivity</li>
<li>Specificity</li>
<li>Precision</li>
<li>F1 Score</li>
<li>Balanced Accuracy</li>
<li>ROC Curve &amp; AUC</li>
</ul></li>
<li><p>K-Fold Cross-Validation</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="motivation" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Motivation</h1>
<section id="what-is-a-classification-problem" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-classification-problem">What is a classification problem?</h2>
<center>
<p><br></p>
<p><img src="https://raw.githubusercontent.com/davi-moreira/naive_bayes/main/figs/boxes.gif" width="800"></p>
<p><br></p>
<p>Classification involves categorizing data into predefined classes or groups based on their features.</p>
</center>
</section>
</section>
<section id="introduction-to-logistic-regression" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Introduction to Logistic Regression</h1>
<section id="what-is-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="what-is-logistic-regression">What is Logistic Regression?</h2>
<ul>
<li><p>A statistical method used for binary classification tasks.</p></li>
<li><p>Predicts the probability of an event occurring (e.g., Yes or No).</p></li>
<li><p>Useful for tasks like determining if a customer will make a purchase.</p></li>
</ul>
</section>
<section id="why-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="why-logistic-regression">Why Logistic Regression?</h2>
<ul>
<li><p>Handles binary outcomes effectively.</p></li>
<li><p>Provides interpretable results (log-odds, odds ratios, and probability).</p></li>
<li><p>Can handle continuous and categorical predictors.</p></li>
</ul>
</section>
</section>
<section id="logistic-regression-framework" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Logistic Regression Framework</h1>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions</h2>
<ol type="1">
<li><p><strong>Binary Dependent Variable</strong>: Logistic regression predicts probabilities for two categories.</p></li>
<li><p><strong>Independent Observations</strong>: Data points should be independent of each other.</p></li>
<li><p><strong>Linearity in the Log-Odds</strong>: The log-odds of the dependent variable should be linearly related to the independent variables.</p></li>
<li><p><strong>No Multicollinearity</strong>: Independent variables should not be highly correlated.</p></li>
</ol>
</section>
<section id="the-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="the-logistic-regression-model">The Logistic Regression Model</h2>
<section id="log-odds-equation" class="level3">
<h3 class="anchored" data-anchor-id="log-odds-equation">Log-Odds Equation</h3>
<p><span class="math display">\[
\text{logit}(P) = \log\left(\frac{P}{1-P}\right) = \beta_0 + \beta_1X_1 + \beta_2X_2 + \dots + \beta_nX_n
\]</span></p>
<div class="nonincremental">
<div style="font-size: 99%;">
<ul>
<li><span class="math inline">\(P\)</span>: Probability of the outcome (e.g., Purchase = Yes).</li>
<li><span class="math inline">\(X_1, X_2, \dots, X_n\)</span>: Predictor variables.</li>
<li><span class="math inline">\(\beta_0, \beta_1, \dots, \beta_n\)</span>: Coefficients.</li>
</ul>
</div>
</div>
</section>
<section id="converting-log-odds-to-probability" class="level3">
<h3 class="anchored" data-anchor-id="converting-log-odds-to-probability">Converting Log-Odds to Probability</h3>
<p><span class="math display">\[
P = \frac{1}{1 + e^{-\text{logit}(P)}}
\]</span></p>
</section>
</section>
</section>
<section id="generating-a-synthetic-business-dataset" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Generating a Synthetic Business Dataset</h1>
<section id="generating-a-synthetic-business-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="generating-a-synthetic-business-dataset-1">Generating a Synthetic Business Dataset</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>In many business scenarios, we aim to predict whether a customer will make a <strong>purchase</strong> based on collected information, usually on demographic and engagement factors. Our synthetic dataset simulates a simplified version of real-world data, capturing:</p>
<ul>
<li><strong>Age</strong>: Customer’s age, distributed around 40 years old with some variation<br>
</li>
<li><strong>Gender</strong>: Categorical variable indicating <code>"Male"</code> or <code>"Female"</code><br>
</li>
<li><strong>Income</strong>: Approximate annual income in US dollars<br>
</li>
<li><strong>Engagement</strong>: A normalized score (0 to 1) reflecting how actively a customer interacts with the business (e.g., website visits, email clicks, etc.)<br>
</li>
<li><strong>Purchase</strong>: A binary outcome (<code>"No"</code> or <code>"Yes"</code>) indicating whether the customer decided to buy a product</li>
</ul>
</div>
</div>
</section>
<section id="generating-a-synthetic-business-dataset-2" class="level2">
<h2 class="anchored" data-anchor-id="generating-a-synthetic-business-dataset-2">Generating a Synthetic Business Dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment and install if needed:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("caret")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("dplyr")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("pROC")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># ensures reproducibility</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Generate basic customer attributes</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>Age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">40</span>, <span class="at">sd =</span> <span class="dv">10</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>Gender <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>Income <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">60000</span>, <span class="at">sd =</span> <span class="dv">10000</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>Engagement <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Make some feature shifts to mimic demographic differences</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    (Optional step to create more distinct sub-groups)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>Engagement[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="ot">&lt;-</span> Engagement[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>Income[Gender <span class="sc">==</span> <span class="st">"Female"</span>]     <span class="ot">&lt;-</span> Income[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="sc">+</span> <span class="dv">3000</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>Age[Gender <span class="sc">==</span> <span class="st">"Female"</span>]        <span class="ot">&lt;-</span> Age[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Define business rules / assumptions for purchase probability</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#    We'll combine a baseline with increments/decrements based on thresholds.</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>baseline_prob <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>purchase_prob <span class="ot">&lt;-</span> <span class="fu">rep</span>(baseline_prob, n)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># a) Customers with higher engagement more likely to buy</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>purchase_prob[Engagement <span class="sc">&gt;=</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> purchase_prob[Engagement <span class="sc">&gt;=</span> <span class="fl">0.5</span>] <span class="sc">+</span> <span class="fl">0.3</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># b) Higher income is a strong indicator of potential purchase</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>purchase_prob[Income <span class="sc">&gt;=</span> <span class="dv">55000</span>] <span class="ot">&lt;-</span> purchase_prob[Income <span class="sc">&gt;=</span> <span class="dv">55000</span>] <span class="sc">+</span> <span class="fl">0.25</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># c) Suppose 'Female' customers have a slight bump in probability</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>purchase_prob[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="ot">&lt;-</span> purchase_prob[Gender <span class="sc">==</span> <span class="st">"Female"</span>] <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># d) Age effect: perhaps older customers (&gt;=45) have slightly higher probability</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>purchase_prob[Age <span class="sc">&gt;=</span> <span class="dv">45</span>] <span class="ot">&lt;-</span> purchase_prob[Age <span class="sc">&gt;=</span> <span class="dv">45</span>] <span class="sc">+</span> <span class="fl">0.05</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Add random noise to reflect real-world unpredictability</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">#    (some random variation that might increase or decrease probabilities)</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.05</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>purchase_prob <span class="ot">&lt;-</span> purchase_prob <span class="sc">+</span> noise</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Clamp probabilities to valid [0, 1] range</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>purchase_prob <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(purchase_prob, <span class="fl">0.01</span>), <span class="fl">0.99</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Generate the Purchase variable via Bernoulli trials</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>Purchase <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> purchase_prob)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Combine into a data frame</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age        =</span> Age,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gender     =</span> <span class="fu">factor</span>(Gender),</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">Income     =</span> Income,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Engagement =</span> Engagement,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">Purchase   =</span> <span class="fu">factor</span>(Purchase, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick checks</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>Purchase)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Exploratory Data Analysis (EDA)</h1>
<section id="summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics">Summary Statistics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="age-vs.-purchase-probability" class="level2">
<h2 class="anchored" data-anchor-id="age-vs.-purchase-probability">Age vs.&nbsp;Purchase Probability</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="income-vs.-purchase-probability" class="level2">
<h2 class="anchored" data-anchor-id="income-vs.-purchase-probability">Income vs.&nbsp;Purchase Probability</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="purchase-rate-by-gender" class="level2">
<h2 class="anchored" data-anchor-id="purchase-rate-by-gender">Purchase Rate by Gender</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="purchase-probability-by-engagement" class="level2">
<h2 class="anchored" data-anchor-id="purchase-probability-by-engagement">Purchase Probability by Engagement</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="correlation-matrix">Correlation Matrix</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="train-test-split" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Train-Test Split</h1>
<section id="train-test-split-1" class="level2">
<h2 class="anchored" data-anchor-id="train-test-split-1">Train-Test Split</h2>
<div style="font-size: 80%;">
<p>Randomly split the data into <strong>train (80%)</strong> and <strong>test (20%)</strong> for unbiased evaluation. This process ensures that the model is trained on one subset of the data and evaluated on another subset, mimicking real-world scenarios where predictions are made on unseen data. It helps to assess how well the model generalizes to new information.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df<span class="sc">$</span>Purchase, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> df[train_index, ]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>test_data  <span class="ot">&lt;-</span> df[<span class="sc">-</span>train_index, ]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train_data<span class="sc">$</span>Purchase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="baseline-prediction" class="level2">
<h2 class="anchored" data-anchor-id="baseline-prediction">Baseline Prediction</h2>
<div class="nonincremental">
<div style="font-size: 99%;">
<p>The baseline prediction is the proportion of customers who made a purchase:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>baseline_prob <span class="ot">&lt;-</span> <span class="fu">mean</span>(train_data<span class="sc">$</span>Purchase <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>baseline_prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li>This baseline represents the probability of a purchase if no predictors are used.</li>
<li>It serves as a reference point to evaluate the added value of the logistic regression model.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="model-training-fitting-a-logistic-regression-model" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Model Training<br>Fitting a Logistic Regression Model</h1>
<section id="fitting-a-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-logistic-regression-model">Fitting a Logistic Regression Model</h2>
<div class="nonincremental">
<div style="font-size: 65%;">
<p>We fit a logistic regression model on the training data and model the relationship between a binary dependent variable and one or more independent variables. Here, we predict the probability of purchase (<code>Purchase</code>) based on customer attributes (<code>Age</code>, <code>Gender</code>, <code>Income</code>, and <code>Engagement</code>).</p>
<p>This step includes specifying:</p>
<ul>
<li><p>The formula (<code>Purchase ~ Age + Gender + Income + Engagement</code>), which defines the relationship between the dependent and independent variables.</p></li>
<li><p>The method (<code>glm</code>), indicating that we are using a generalized linear model.</p></li>
<li><p>The link function (<code>binomial(link = "logit")</code>), ensuring the model estimates probabilities using the logistic function.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> prSummary    <span class="co"># &lt;--- uses Precision, Recall, F, AUC</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>model_fit <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  Purchase <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Income <span class="sc">+</span> Engagement,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric    =</span> <span class="st">"F"</span>          <span class="co"># or "AUC", "Precision", "Recall"</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_fit<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The summary provides details about the model’s coefficients, which indicate the strength and direction of each predictor’s influence on the purchase probability.</p>
<p><br></p>
<p><br></p>
</div>
</div>
</section>
</section>
<section id="predictions-on-the-test-set" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Predictions on the Test Set</h1>
<section id="predictions-on-the-test-set-1" class="level2">
<h2 class="anchored" data-anchor-id="predictions-on-the-test-set-1">Predictions on the Test Set</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>To evaluate the model, we obtain predictions for the test set. This involves two steps:</p>
<ol type="1">
<li><p><strong>Class Predictions:</strong> Predicting the most likely class (e.g., <code>Yes</code> or <code>No</code>) for each observation.</p></li>
<li><p><strong>Probability Predictions:</strong> Predicting the probability of each class, which provides more nuanced insights.</p></li>
</ol>
<p>This allows us to assess the model’s ability to generalize to unseen data and evaluate its performance using metrics such as accuracy, ROC-AUC, and confusion matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pred_classes <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_fit, <span class="at">newdata =</span> test_data)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pred_probs   <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_fit, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_classes)  <span class="co"># Displays the predicted classes for the first few observations</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_probs)    <span class="co"># Displays the predicted probabilities for the first few observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By analyzing these predictions, we can determine how well the model distinguishes between <code>Yes</code> and <code>No</code> cases and identify areas for improvement.</p>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Model Evaluation</h1>
<section id="confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>The confusion matrix provides a summary of prediction results. It compares the predicted and actual classes, offering insights into the model’s classification performance.</p>
<div class="center">
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="confusion-matrix-1" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-1">Confusion Matrix</h2>
<div class="nonincremental">
<div style="font-size: 75%;">
<p>Key metrics derived from the confusion matrix include:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption><strong>Performance Metrics</strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.6950</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.8492</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.4324</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision</td>
<td style="text-align: right;">0.7181</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: right;">0.7782</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><strong>Accuracy:</strong> The proportion of correct predictions.</li>
<li><strong>Sensitivity (Recall):</strong> The model’s ability to identify positive cases.</li>
<li><strong>Specificity:</strong> The model’s ability to identify negative cases.</li>
<li><strong>Precision:</strong> Among predicted positive cases, the proportion that are truly positive.</li>
<li><strong>F1 Score:</strong> The harmonic mean of Precision and Sensitivity, balancing false positives and false negatives.</li>
</ul>
</div>
</div>
</section>
<section id="accuracy" class="level2">
<h2 class="anchored" data-anchor-id="accuracy">Accuracy</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<div style="display: flex; align-items: center; gap: 2em;">
<div class="column" style="flex: 1;">
<center>
<strong>Confusion Matrix</strong>
</center>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
<div class="column" style="flex: 1;">
<center>
<strong>Formula</strong>
</center>
<p><br></p>
<p><span class="math display">\[
\text{Accuracy} = \frac{\text{TP} + \text{TN}}{\text{TP} + \text{TN} + \text{FP} + \text{FN}}
\]</span></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li><p>Overall effectiveness of the model.</p></li>
<li><p>In the context of weather forecasting, for example, accuracy reflects how well a model predicts weather events correctly (e.g., rainy or sunny days).</p></li>
<li><p><strong>High accuracy</strong>: lots of correct predictions!</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="recall-sensitivity" class="level2">
<h2 class="anchored" data-anchor-id="recall-sensitivity">Recall (Sensitivity)</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<div style="display: flex; align-items: center; gap: 2em;">
<div class="column" style="flex: 1;">
<center>
<strong>Confusion Matrix</strong>
</center>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
<div class="column" style="flex: 1;">
<center>
<strong>Formula</strong>
</center>
<p><br></p>
<p><span class="math display">\[
\text{Recall} = \frac{\text{TP}}{\text{TP} + \text{FN}}
\]</span></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li><p>Is the fraction of positives correctly identified.</p></li>
<li><p>In criminal justice, it would assess how well a predictive policing model identifies all potential criminal activities (True Positives) without missing any (thus minimizing False Negatives).</p></li>
<li><p><strong>High recall</strong>: low false-negative rates.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="specificity" class="level2">
<h2 class="anchored" data-anchor-id="specificity">Specificity</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<div style="display: flex; align-items: center; gap: 2em;">
<div class="column" style="flex: 1;">
<center>
<strong>Confusion Matrix</strong>
</center>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
<div class="column" style="flex: 1;">
<center>
<strong>Formula</strong>
</center>
<p><br></p>
<p><span class="math display">\[
\text{Specificity} = \frac{\text{TN}}{\text{TN} + \text{FP}}
\]</span></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li><p>It is the true negative rate, measuring a model’s ability to correctly identify actual negatives.</p></li>
<li><p>Crucial in fields where incorrectly identifying a negative case as positive could have serious implications (e.g., criminal justice).</p></li>
<li><p><strong>High specificity</strong>: the model is very effective at identifying true negatives.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="precision" class="level2">
<h2 class="anchored" data-anchor-id="precision">Precision</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<div style="display: flex; align-items: center; gap: 2em;">
<div class="column" style="flex: 1;">
<center>
<strong>Confusion Matrix</strong>
</center>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
<div class="column" style="flex: 1;">
<center>
<strong>Formula</strong>
</center>
<p><br></p>
<p><span class="math display">\[
\text{Precision} = \frac{\text{TP}}{\text{TP} + \text{FP}}
\]</span></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li><p>Accuracy of positive predictions.</p></li>
<li><p>In email spam detection, it would indicate the percentage of emails correctly identified as spam (True Positives) out of all emails flagged as spam, aiming to reduce the number of legitimate emails incorrectly marked as spam (False Positives).</p></li>
<li><p><strong>High precision</strong>: low false-positive rates.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="f1-score" class="level2">
<h2 class="anchored" data-anchor-id="f1-score">F1-Score</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<div style="display: flex; align-items: center; gap: 2em;">
<div class="column" style="flex: 1;">
<center>
<strong>Confusion Matrix</strong>
</center>
<p><br></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Predicted: 0</th>
<th>Predicted: 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: 0</strong></td>
<td>True Negative (TN)</td>
<td>False Positive (FP)</td>
</tr>
<tr class="even">
<td><strong>Actual: 1</strong></td>
<td>False Negative (FN)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
</div>
<div class="column" style="flex: 1;">
<center>
<strong>Formula</strong>
</center>
<p><br></p>
<p><span class="math display">\[
\text{F1} = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}
\]</span></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li><p>Harmonic mean of Precision and Recall.</p></li>
<li><p>In a medical diagnosis scenario, it would help in evaluating a test’s effectiveness in correctly identifying patients with a disease (True Positives) while minimizing the misclassification of healthy individuals as diseased (False Positives and False Negatives).</p></li>
<li><p><strong>High F1 score</strong>: a better balance between precision and recall.</p></li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="roc-curve-auc" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">ROC Curve &amp; AUC</h1>
<section id="roc-curve-auc-1" class="level2">
<h2 class="anchored" data-anchor-id="roc-curve-auc-1">ROC Curve &amp; AUC</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>The ROC (Receiver Operating Characteristic) curve is a graphical representation that illustrates the trade-off between the true positive rate (Sensitivity) and the false positive rate (1 - Specificity) across various threshold values. The AUC (Area Under the Curve) summarizes the ROC curve into a single value, indicating the model’s overall performance.</p>
<ul>
<li><p><strong>AUC Interpretation:</strong></p>
<ul>
<li><strong>AUC</strong> <span class="math inline">\(\approx\)</span> 1: The model has near-perfect predictive capability.</li>
<li><strong>AUC</strong> <span class="math inline">\(\approx\)</span> 0.5: The model performs no better than random guessing.</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="roc-curve-auc-2" class="level2">
<h2 class="anchored" data-anchor-id="roc-curve-auc-2">ROC Curve &amp; AUC</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>The ROC curve and AUC provide a comprehensive evaluation of the model’s discriminatory power.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>AUC Value:</strong> Indicates the likelihood that the model will correctly distinguish between a positive and a negative instance. Higher values reflect better model performance.</p>
</div>
</div>
</section>
</section>
<section id="k-fold-cross-validation" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">K-Fold Cross-Validation</h1>
<section id="k-fold-cross-validation-1" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation-1">K-Fold Cross-Validation</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>K-Fold Cross-Validation is a resampling technique that evaluates model performance by dividing the dataset into <strong>k subsets (folds)</strong>. The model is trained on <strong>k-1 folds</strong> and validated on the remaining fold, repeating this process <span class="math inline">\(k\)</span> times to ensure each fold serves as the validation set once.</p>
<p><strong>Advantages of K-Fold Cross-Validation:</strong></p>
<ul>
<li>Reduces overfitting by training and validating on different subsets.</li>
<li>Provides a more reliable estimate of model performance compared to a single train-test split.</li>
<li>Ensures the model generalizes well to unseen data.</li>
</ul>
</div>
</div>
</section>
<section id="k-fold-cross-validation-2" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation-2">K-Fold Cross-Validation</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("MLmetrics")</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLmetrics)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method          =</span> <span class="st">"cv"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">number          =</span> <span class="dv">10</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> .<span class="dv">8</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> prSummary    <span class="co"># &lt;--- uses Precision, Recall, F, AUC</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>model_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  Purchase <span class="sc">~</span> .,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data      =</span> train_data,  <span class="co"># or your entire df, depending on your design</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">method    =</span> <span class="st">"glm"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric    =</span> <span class="st">"F"</span>          <span class="co"># or "AUC", "Precision", "Recall"</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the cross-validation results:</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># model_cv  # Displays cross-validated model performance</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>model_cv<span class="sc">$</span>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="comparing-train-test-performance-and-k-fold-cross-validation-performance" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</h1>
<section id="comparing-train-test-performance-and-k-fold-cross-validation-performance-1" class="level2">
<h2 class="anchored" data-anchor-id="comparing-train-test-performance-and-k-fold-cross-validation-performance-1">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</h2>
<div class="nonincremental">
<div style="font-size: 70%;">
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment">
<ol type="1">
<li><p><strong>Assessing Model Generalization</strong></p>
<ul>
<li>Train-Test Performance evaluates how well a model generalizes to unseen data from a single split.</li>
<li>K-Fold Cross-Validation provides a more robust performance estimate across multiple splits.</li>
<li>Comparing the two ensures consistent performance on unseen data.</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<ol start="2" type="1">
<li><p><strong>Detecting Overfitting or Underfitting</strong></p>
<ul>
<li><strong>Overfitting</strong>: Train-test performance is much better than K-Fold performance.</li>
<li><strong>Underfitting</strong>: Both metrics show poor performance.</li>
<li>The comparison highlights issues with model complexity.</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li><p><strong>Mitigating Sampling Bias</strong></p>
<ul>
<li>Single splits (train-test) can introduce sampling bias, especially with small datasets.</li>
<li>Cross-validation averages performance across folds, reducing bias.</li>
<li>Ensures reliability of performance estimates.</li>
</ul></li>
</ol>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment">
<ol start="4" type="1">
<li><p><strong>Understanding Variance in Model Evaluation</strong></p>
<ul>
<li>Train-test performance can vary based on split choice.</li>
<li>K-Fold Cross-Validation offers insights into the variance of the performance estimate.</li>
<li>Aids in strategies to reduce variance, such as adding more data.</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<ol start="5" type="1">
<li><p><strong>Model Selection and Hyperparameter Tuning</strong></p>
<ul>
<li>Cross-validation is used for stable performance estimates during training.</li>
<li>Train-Test Performance validates the chosen model’s final performance.</li>
<li>Discrepancies indicate potential overfitting during tuning.</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<ol start="6" type="1">
<li><p><strong>Real-World Applicability</strong></p>
<ul>
<li>Train-Test: Simpler, faster, checks practical performance on unseen data.</li>
<li>K-Fold Cross-Validation: Provides theoretical robustness.</li>
<li>Bridging evaluation theory and deployment performance.</li>
</ul></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="comparing-train-test-performance-and-k-fold-cross-validation-performance-2" class="level2">
<h2 class="anchored" data-anchor-id="comparing-train-test-performance-and-k-fold-cross-validation-performance-2">Comparing Train-Test Performance and K-Fold Cross-Validation Performance</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Single Train-Test Performance</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Compute confusion matrix to get Precision, Recall, F1</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>train_test_metrics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data      =</span> pred_classes,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> test_data<span class="sc">$</span>Purchase,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive  =</span> <span class="st">"Yes"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate AUC on the test set</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>roc_obj_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span>Purchase, pred_probs<span class="sc">$</span>Yes, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>auc_test     <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">auc</span>(roc_obj_test))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Obtain 95% CI for the AUC</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>auc_test_ci  <span class="ot">&lt;-</span> <span class="fu">ci</span>(roc_obj_test, <span class="at">of =</span> <span class="st">"auc"</span>)  <span class="co"># typically returns c(lower, median, upper)</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Extract the relevant metrics</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>train_test_results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC        =</span> auc_test,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision  =</span> train_test_metrics<span class="sc">$</span>byClass[[<span class="st">"Pos Pred Value"</span>]],</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Recall     =</span> train_test_metrics<span class="sc">$</span>byClass[[<span class="st">"Sensitivity"</span>]],</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1         =</span> train_test_metrics<span class="sc">$</span>byClass[[<span class="st">"F1"</span>]]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># K-Fold Cross-Validation Metrics</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the row with the highest F in model_cv</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>best_idx  <span class="ot">&lt;-</span> <span class="fu">which.max</span>(model_cv<span class="sc">$</span>results<span class="sc">$</span>F)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>cv_metrics <span class="ot">&lt;-</span> model_cv<span class="sc">$</span>results[best_idx, ]</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming model_cv$results contains columns like:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">#  AUC, AUCSD, Precision, PrecisionSD, Recall, RecallSD, F, FSD</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co"># (from a custom prSummary or similar)</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC             =</span> cv_metrics[[<span class="st">"AUC"</span>]],</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC_lower       =</span> cv_metrics[[<span class="st">"AUC"</span>]] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"AUCSD"</span>]],</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC_upper       =</span> cv_metrics[[<span class="st">"AUC"</span>]] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"AUCSD"</span>]],</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision       =</span> cv_metrics[[<span class="st">"Precision"</span>]],</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision_lower =</span> cv_metrics[[<span class="st">"Precision"</span>]] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"PrecisionSD"</span>]],</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision_upper =</span> cv_metrics[[<span class="st">"Precision"</span>]] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"PrecisionSD"</span>]],</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">Recall          =</span> cv_metrics[[<span class="st">"Recall"</span>]],</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">Recall_lower    =</span> cv_metrics[[<span class="st">"Recall"</span>]] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"RecallSD"</span>]],</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">Recall_upper    =</span> cv_metrics[[<span class="st">"Recall"</span>]] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"RecallSD"</span>]],</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1              =</span> cv_metrics[[<span class="st">"F"</span>]],</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1_lower        =</span> cv_metrics[[<span class="st">"F"</span>]] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"FSD"</span>]],</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1_upper        =</span> cv_metrics[[<span class="st">"F"</span>]] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cv_metrics[[<span class="st">"FSD"</span>]]</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Results</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Train_Test =</span> train_test_results,</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">K_Fold_CV  =</span> cv_results</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-single-train-test-vs-k-fold-cv" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-single-train-test-vs-k-fold-cv">Visualizing Single Train-Test vs K-Fold CV</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_model_evaluation_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Summary</h1>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">Summary</h2>
<div class="nonincremental">
<div style="font-size: 80%;">
<p>Main Takeaways from this lecture:</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Logistic Regression Framework</strong> - Logistic regression is a powerful method for binary classification. - Key assumptions: - Binary dependent variable. - Linearity in log-odds. - No multicollinearity among predictors.</p>
<p><strong>Evaluation Metrics</strong></p>
<ul>
<li><p><strong>Confusion Matrix</strong> provides:</p>
<ul>
<li>Sensitivity (Recall)</li>
<li>Specificity</li>
<li>Precision</li>
<li>F1 Score</li>
</ul></li>
<li><p><strong>ROC Curve and AUC</strong> evaluate model discrimination across thresholds.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li><p><strong>Train-Test Split</strong>:</p>
<ul>
<li>Ensures the model is trained and tested on separate datasets.</li>
<li>Baseline accuracy serves as a benchmark for improvement.</li>
</ul></li>
<li><p><strong>K-Fold Cross-Validation</strong>:</p>
<ul>
<li>Reduces overfitting and sampling bias.</li>
<li>Provides a reliable estimate of model performance.</li>
</ul></li>
</ul>
<p><strong>Performance Comparison</strong></p>
<ul>
<li>Cross-validation metrics give a robust view of generalization.</li>
<li>Train-test split results provide practical insights for deployment.</li>
<li>Use both approaches for a comprehensive evaluation.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="thank-you" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Thank you!</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>