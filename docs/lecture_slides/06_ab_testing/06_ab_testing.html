<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor: Davi Moreira">

<title> MGMT 17300: Data Mining Lab  – MGMT 17300: Data Mining Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/mgmt_17300_ai_logo_03.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/davi-moreira/2025S_data_mining_lab_purdue_MGMT173" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule and Material</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#study-design" id="toc-study-design" class="nav-link" data-scroll-target="#study-design">Study Design</a>
  <ul class="collapse">
  <li><a href="#study-design-1" id="toc-study-design-1" class="nav-link" data-scroll-target="#study-design-1">Study Design</a></li>
  <li><a href="#study-design-2" id="toc-study-design-2" class="nav-link" data-scroll-target="#study-design-2">Study Design</a></li>
  <li><a href="#study-design-random-assignment-vs.-random-sampling" id="toc-study-design-random-assignment-vs.-random-sampling" class="nav-link" data-scroll-target="#study-design-random-assignment-vs.-random-sampling">Study Design: Random Assignment vs.&nbsp;Random Sampling</a></li>
  </ul></li>
  <li><a href="#introduction-to-ab-testing" id="toc-introduction-to-ab-testing" class="nav-link" data-scroll-target="#introduction-to-ab-testing">Introduction to A/B Testing</a>
  <ul class="collapse">
  <li><a href="#ab-testing" id="toc-ab-testing" class="nav-link" data-scroll-target="#ab-testing">A/B Testing</a></li>
  </ul></li>
  <li><a href="#data-simulation-for-ab-testing" id="toc-data-simulation-for-ab-testing" class="nav-link" data-scroll-target="#data-simulation-for-ab-testing">Data Simulation for A/B Testing</a>
  <ul class="collapse">
  <li><a href="#generating-synthetic-data" id="toc-generating-synthetic-data" class="nav-link" data-scroll-target="#generating-synthetic-data">Generating Synthetic Data</a></li>
  </ul></li>
  <li><a href="#statistical-testing-in-r" id="toc-statistical-testing-in-r" class="nav-link" data-scroll-target="#statistical-testing-in-r">Statistical Testing in R</a>
  <ul class="collapse">
  <li><a href="#the-need-for-statistical-testing" id="toc-the-need-for-statistical-testing" class="nav-link" data-scroll-target="#the-need-for-statistical-testing">The Need for Statistical Testing</a></li>
  <li><a href="#common-statistical-tests-in-ab-testing" id="toc-common-statistical-tests-in-ab-testing" class="nav-link" data-scroll-target="#common-statistical-tests-in-ab-testing">Common Statistical Tests in A/B Testing</a></li>
  <li><a href="#chi-square-test" id="toc-chi-square-test" class="nav-link" data-scroll-target="#chi-square-test">Chi-Square Test</a></li>
  <li><a href="#two-sample-proportion-test" id="toc-two-sample-proportion-test" class="nav-link" data-scroll-target="#two-sample-proportion-test">Two-Sample Proportion Test</a></li>
  </ul></li>
  <li><a href="#visualizing-and-interpreting-results" id="toc-visualizing-and-interpreting-results" class="nav-link" data-scroll-target="#visualizing-and-interpreting-results">Visualizing and Interpreting Results</a>
  <ul class="collapse">
  <li><a href="#visualize-confidence-intervals" id="toc-visualize-confidence-intervals" class="nav-link" data-scroll-target="#visualize-confidence-intervals">Visualize Confidence Intervals</a></li>
  <li><a href="#effect-size-calculation" id="toc-effect-size-calculation" class="nav-link" data-scroll-target="#effect-size-calculation">Effect Size Calculation</a></li>
  <li><a href="#effect-size-quantification" id="toc-effect-size-quantification" class="nav-link" data-scroll-target="#effect-size-quantification">Effect Size Quantification</a></li>
  </ul></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final Remarks</a>
  <ul class="collapse">
  <li><a href="#final-remarks-1" id="toc-final-remarks-1" class="nav-link" data-scroll-target="#final-remarks-1">Final Remarks</a></li>
  </ul></li>
  <li><a href="#additional-material" id="toc-additional-material" class="nav-link" data-scroll-target="#additional-material">Additional Material</a>
  <ul class="collapse">
  <li><a href="#additional-material-1" id="toc-additional-material-1" class="nav-link" data-scroll-target="#additional-material-1">Additional Material</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank you!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="06_ab_testing.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span style="font-size: 100%;"> MGMT 17300: Data Mining Lab </span></h1>
<p class="subtitle lead"><span style="font-size: 150%;">A/B Testing (Experimentation)</span></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Professor: Davi Moreira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<div class="nonincremental">
<div class="columns">
<div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li>Introduction to A/B Testing</li>
<li>Statistical Testing Methods</li>
</ul>
</div><div class="column" style="text-align: center; justify-content: center; align-items: center;">
<ul>
<li>Effect Size and Business Implications</li>
<li>Practical Applications of A/B Testing</li>
</ul>
</div>
</div>
</div>
</section>
<section id="study-design" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Study Design</h1>
<section id="study-design-1" class="level2">
<h2 class="anchored" data-anchor-id="study-design-1">Study Design</h2>
<div class="columns">
<div class="column" style="text-align: center; justify-content: center; align-items: center;">
<p><strong>Observational</strong></p>
<p>In observational studies, no attempt is made to control or influence the variables of interest. A survey is a good example.</p>
<p><br> <br> <br></p>
<blockquote class="blockquote">
<p>Example: researchers observing a randomly selected group of customers that enter a Walmart Supercenter to collect data on variables such as time spent in the store, gender of the customer, and the amount spent.</p>
</blockquote>
</div><div class="column" style="text-align: center; justify-content: center; align-items: center;">
<p><strong>Experimental</strong></p>
<p>An experimental study involves the active manipulation of one or more independent variables to observe their effect on a dependent variable, while controlling for confounding factors. Participants are typically randomly assigned to groups (e.g., treatment vs.&nbsp;control), and outcomes are compared to determine causal relationships. This design provides strong evidence for cause-and-effect due to the controlled environment and random assignment.</p>
<!---The researcher actively manipulates one or more independent (treatment) variables to observe the effect on a dependent (outcome) variable, while controlling for other potential confounding factors. This type of study aims to establish causal relationships between variables. In an experimental study, subjects are usually randomly assigned to different groups or conditions (e.g., treatment vs. control), and the outcomes are compared to determine the impact of the manipulated variable. The strength of experimental studies lies in their ability to provide strong evidence for cause-and-effect relationships due to the controlled environment and random assignment.--->
<blockquote class="blockquote">
<p>The largest experimental study ever conducted is believed to be the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1114166/">1954 Public Health Service experiment</a> for the Salk polio vaccine. Nearly two million U.S. children (grades 1 through 3) were selected.</p>
</blockquote>
</div>
</div>
</section>
<section id="study-design-2" class="level2">
<h2 class="anchored" data-anchor-id="study-design-2">Study Design</h2>
<p><br></p>
<p><br></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/xkcd.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:2.0%"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><br></p>
<p><br></p>
</section>
<section id="study-design-random-assignment-vs.-random-sampling" class="level2">
<h2 class="anchored" data-anchor-id="study-design-random-assignment-vs.-random-sampling">Study Design: Random Assignment vs.&nbsp;Random Sampling</h2>
<p><br></p>
<p><br></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/random_assignment_sampling.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><br></p>
</section>
</section>
<section id="introduction-to-ab-testing" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Introduction to A/B Testing</h1>
<section id="ab-testing" class="level2">
<h2 class="anchored" data-anchor-id="ab-testing">A/B Testing</h2>
<ul>
<li><p><strong>Definition</strong>: A/B Testing is an experimental design technique to compare two versions (A and B) of a variable to determine which one performs better.</p></li>
<li><p><strong>Applications</strong>:</p>
<ul>
<li>Marketing: Testing website versions.</li>
<li>Operations: Evaluating process changes.</li>
<li>Product Development: Comparing feature designs.</li>
</ul></li>
<li><p><strong>Key Components</strong>:</p>
<ul>
<li><strong>Control Group (A)</strong>: Baseline version.</li>
<li><strong>Treatment Group (B)</strong>: Modified version.</li>
<li><strong>Metric</strong>: The outcome to measure success (e.g., conversion rate, click-through rate).</li>
</ul></li>
</ul>
</section>
</section>
<section id="data-simulation-for-ab-testing" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Data Simulation for A/B Testing</h1>
<section id="generating-synthetic-data" class="level2">
<h2 class="anchored" data-anchor-id="generating-synthetic-data">Generating Synthetic Data</h2>
<div style="font-size: 80%;">
<p>This simulation aims to replicate a business scenario where a company is testing two different versions of a website to improve user conversions.</p>
<p>The Control Group (A) represents the current version of the website, which has a baseline conversion rate of 10%.</p>
<p>The Treatment Group (B) represents a redesigned website with potentially improved usability, targeting a higher conversion rate of 12%. The simulation generates data to mimic user interactions for both groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary library</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensures that the random numbers generated are the same every time the code is run.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data for Group A (Control) and Group B (Treatment)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># `n` defines the number of samples per group.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector indicating group membership.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The `rep` function repeats "A" and "B" `n` times to assign each sample to a group.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">each =</span> n)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate conversion outcomes for each group using the binomial distribution.</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># `rbinom` creates binary outcomes (0 or 1) for conversions.</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Group A has a 10% conversion rate, and Group B has a 15% conversion rate.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>conversion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.10</span>),  <span class="co"># Group A conversion rate: 10%</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.15</span>))  <span class="co"># Group B conversion rate: 15%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame combining group and conversion outcomes.</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row represents an individual observation.</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>ab_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(group, conversion)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data by group.</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates the conversion rate (mean of conversion) and the count (number of observations) for each group.</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> ab_data <span class="sc">%&gt;%</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conversion_rate =</span> <span class="fu">mean</span>(conversion),  <span class="co"># Average conversion per group</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">count =</span> <span class="fu">n</span>())                         <span class="co"># Total samples per group</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summarized data to view conversion rates and counts for each group.</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># print(summary)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="statistical-testing-in-r" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Statistical Testing in R</h1>
<section id="the-need-for-statistical-testing" class="level2">
<h2 class="anchored" data-anchor-id="the-need-for-statistical-testing">The Need for Statistical Testing</h2>
<ul>
<li><p>A/B Testing relies on data sampled from populations, which can be influenced by random chance.</p></li>
<li><p>Statistical testing helps determine whether observed differences in metrics (e.g., conversion rates) are statistically significant or just due to random variation.</p></li>
<li><p>Without statistical testing, business decisions might be based on misleading results.</p></li>
</ul>
</section>
<section id="common-statistical-tests-in-ab-testing" class="level2">
<h2 class="anchored" data-anchor-id="common-statistical-tests-in-ab-testing">Common Statistical Tests in A/B Testing</h2>
<ol type="1">
<li><p><strong>Chi-Square Test</strong>: Used to compare categorical data (e.g., conversion rates).</p></li>
<li><p><strong>Two-Sample Proportion Test</strong>: Compares the proportions between two groups.</p></li>
<li><p><strong>T-Test</strong>: Compares means between two groups (e.g., average time spent on site).</p></li>
<li><p><strong>Mann-Whitney U Test</strong>: A non-parametric test to compare distributions.</p></li>
<li><p><strong>ANOVA</strong>: Used when comparing more than two groups.</p></li>
</ol>
</section>
<section id="chi-square-test" class="level2">
<h2 class="anchored" data-anchor-id="chi-square-test">Chi-Square Test</h2>
<div style="font-size: 80%;">
<p>The Chi-Square Test evaluates whether there is a statistically significant association between group membership (A or B) and conversion outcomes (success or failure). In our example, it helps us determine if the higher conversion rate observed in Group B is due to the redesign or random chance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a contingency table</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>table_ab <span class="ot">&lt;-</span> <span class="fu">table</span>(ab_data<span class="sc">$</span>group, ab_data<span class="sc">$</span>conversion)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Chi-Square Test</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>chi_test <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_ab)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Considerations</strong>:</p>
<ul>
<li><p><strong>Assumptions</strong>: Requires expected frequencies &gt; 5 in each cell. Ensure sample sizes are adequate.</p></li>
<li><p><strong>P-Value</strong>: A small p-value (&lt; 0.05) suggests that the difference in conversion rates is statistically significant.</p></li>
</ul>
<div class="fragment">
<p><strong>Conclusion</strong>:</p>
<ul>
<li><p>The p-value (0.00129) is significantly less than 0.05, indicating a statistically significant difference in conversion rates between Group A and Group B.</p></li>
<li><p>This supports the hypothesis that the redesign (Group B) has a positive impact on conversions.</p></li>
</ul>
</div>
</div>
</section>
<section id="two-sample-proportion-test" class="level2">
<h2 class="anchored" data-anchor-id="two-sample-proportion-test">Two-Sample Proportion Test</h2>
<div style="font-size: 70%;">
<p>This test compares the conversion proportions directly between the two groups. It is particularly useful for binary outcomes, like conversions, where we want to quantify the difference in proportions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion counts</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>conversions <span class="ot">&lt;-</span> <span class="fu">table</span>(ab_data<span class="sc">$</span>group, ab_data<span class="sc">$</span>conversion)[, <span class="dv">2</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(ab_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"A"</span>), <span class="fu">sum</span>(ab_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"B"</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion test</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>prop_test <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(conversions, total)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prop_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Considerations</strong>:</p>
<ul>
<li><p><strong>P-Value</strong>: Indicates whether the observed difference is significant.</p></li>
<li><p><strong>Confidence Interval</strong>: Provides the range of plausible values for the difference in conversion rates.</p></li>
<li><p><strong>Effect Size</strong>: Quantifies the magnitude of the difference, helping gauge practical significance.</p></li>
</ul>
<div class="fragment">
<p><strong>Conclusion</strong>:</p>
<ul>
<li><p>The p-value (0.00129) is less than 0.05, confirming a statistically significant difference in conversion rates between Group A and Group B.</p></li>
<li><p>The confidence interval (-0.0759 to -0.0181) does not include 0, which further supports the finding of a significant difference.</p></li>
<li><p>The observed conversion rates (9.2% for Group A and 13.9% for Group B) suggest that the redesign (Group B) leads to higher conversions in a practically meaningful way.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="visualizing-and-interpreting-results" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Visualizing and Interpreting Results</h1>
<section id="visualize-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="visualize-confidence-intervals">Visualize Confidence Intervals</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06_ab_testing_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="effect-size-calculation" class="level2">
<h2 class="anchored" data-anchor-id="effect-size-calculation">Effect Size Calculation</h2>
<div style="font-size: 70%;">
<p>Effect size quantifies the magnitude of the observed difference between two groups, helping to interpret its practical significance. For this example, we use <a href="https://en.wikipedia.org/wiki/Cohen%27s_h">Cohen’s <span class="math inline">\(h\)</span></a>, which is calculated as:</p>
<p><span class="math display">\[ h = 2 \times \arcsin(\sqrt{p_2}) - 2 \times \arcsin(\sqrt{p_1}) \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions for Group A and Group B</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> summary<span class="sc">$</span>conversion_rate[summary<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"A"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> summary<span class="sc">$</span>conversion_rate[summary<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"B"</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Cohen's h</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">asin</span>(<span class="fu">sqrt</span>(p2)) <span class="sc">-</span> <span class="fu">asin</span>(<span class="fu">sqrt</span>(p1)))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display effect size</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Cohen's h: "</span>, h, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li><strong>Small Effect</strong>: h ≈ 0.2</li>
<li><strong>Medium Effect</strong>: h ≈ 0.5</li>
<li><strong>Large Effect</strong>: h ≈ 0.8</li>
</ul>
<div class="fragment">
<p><strong>Conclusion:</strong> Based on the calculated Cohen’s h (0.1477):</p>
<ul>
<li><p>The effect size is small, suggesting that while the redesign of Group B had a statistically significant improvement in conversion rates, the practical impact is relatively modest.</p></li>
<li><p>This indicates that additional changes or optimizations may be necessary to achieve a more substantial effect in improving conversions.</p></li>
</ul>
</div>
</div>
</section>
<section id="effect-size-quantification" class="level2">
<h2 class="anchored" data-anchor-id="effect-size-quantification">Effect Size Quantification</h2>
<p>Using the difference in conversion rates:</p>
<ul>
<li>Conversion rate for Group A: <span class="math inline">\(p_1 = 0.092\)</span></li>
<li>Conversion rate for Group B: <span class="math inline">\(p_2 = 0.139\)</span></li>
<li>Difference in conversion rates: <span class="math inline">\(\Delta p = p_2 - p_1 = 0.047\)</span></li>
</ul>
<div class="fragment">
<p>For every 1,000 users in each group, additional conversions: <span class="math inline">\(\Delta p \times n = 0.047 \times 1000 = 47\)</span>.</p>
<p><strong>Conclusion</strong>: The redesign in Group B is expected to generate <strong>47 additional conversions per 1,000 users</strong> compared to Group A. While the effect size (Cohen’s h) is small, this additional number of conversions demonstrates a meaningful business impact for larger user bases.</p>
</div>
</section>
</section>
<section id="final-remarks" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Final Remarks</h1>
<section id="final-remarks-1" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks-1">Final Remarks</h2>
<ul>
<li><strong>Lessons from the Example</strong>:
<ul>
<li>Proper experimental design and statistical testing are critical to ensuring reliable results.</li>
<li>The results from this analysis clearly showed that the redesign significantly improved conversion rates.</li>
</ul></li>
<li><strong>Practical Use of A/B Testing</strong>:
<ul>
<li>A/B Testing is a powerful tool in business analytics for optimizing decision-making processes.</li>
<li>It allows businesses to empirically evaluate the impact of changes (e.g., website design, pricing strategies) on user behavior.</li>
</ul></li>
<li><strong>Broader Implications</strong>:
<ul>
<li>Businesses can use these methods to enhance user experience, increase revenue, and gain a competitive edge.</li>
</ul></li>
</ul>
</section>
</section>
<section id="additional-material" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Additional Material</h1>
<section id="additional-material-1" class="level2">
<h2 class="anchored" data-anchor-id="additional-material-1">Additional Material</h2>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/explore/vignettes/abtest.html">explore: Simplifies Exploratory Data Analysis</a></p></li>
<li><p><a href="https://rpubs.com/odenipinedo/AB-testing-in-R">AB Testing in R</a></p></li>
</ul>
</section>
</section>
<section id="summary" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Summary</h1>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">Summary</h2>
<div class="nonincremental">
<div style="font-size: 99%;">
<p>Main Takeaways from this lecture:</p>
<ul>
<li><p>The Chi-Square and Proportion Tests help determine if differences between groups are due to real effects or random variability.</p></li>
<li><p>Interpreting statistical metrics like p-values, confidence intervals, and effect sizes ensures robust conclusions.</p></li>
<li><p>Visualizing results with confidence intervals enhances clarity and aids in communicating findings effectively.</p></li>
<li><p>A/B Testing is a vital tool for businesses to optimize strategies, boost user engagement, and achieve better conversion rates.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="thank-you" class="level1" data-background-color="#cfb991">
<h1 data-background-color="#cfb991">Thank you!</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>